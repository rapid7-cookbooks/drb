require 'drb/drb'

URI = "druby://0.0.0.0:<%= @drb_port %>"

class TimeServer
  def get_current_time
    Time.now
  end
end

SERVER = TimeServer.new

# Disable eval() and friends?
<% if @safe %>
  $SAFE = <%= @safe %>
<% else %>
  # Set $SAFE to a value between 1 through 4 for a higher level of safety. $SAFE defaults to 0.
<% end %>

case ARGV.first
when 'start'
  DRb.start_service(URI, SERVER)

  # Wait for the drb server thread to finish before exiting.
  DRb.thread.join
end
